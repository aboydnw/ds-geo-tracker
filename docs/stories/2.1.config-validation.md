# Story 2.1: Configuration Validation

## Status
Draft

## Story
**As a** developer,  
**I want** startup validation of all required configuration,  
**so that** misconfiguration is caught immediately with helpful error messages.

## Acceptance Criteria
1. `src/config.js` exports `validateConfig()` function
2. Validates `PLAUSIBLE_DOMAIN` is set and non-empty
3. Validates `PLAUSIBLE_DOMAIN` is a valid domain format (basic regex check)
4. Logs clear error message identifying which variable is missing/invalid
5. Returns validation result object with `valid` boolean and `errors` array
6. Main script calls `validateConfig()` on startup and exits if invalid

## Tasks / Subtasks
- [ ] Create `src/config.js` file (AC: 1)
- [ ] Implement `validateConfig` function (AC: 1, 5)
  - [ ] Define return type: `{ valid: boolean, errors: string[] }`
  - [ ] Initialize empty errors array
- [ ] Add PLAUSIBLE_DOMAIN validation (AC: 2, 3)
  - [ ] Check if env var exists and is non-empty
  - [ ] Validate domain format with regex (basic: contains dot, no spaces)
  - [ ] Add descriptive error messages
- [ ] Implement error logging (AC: 4)
  - [ ] Log each validation error with clear description
  - [ ] Include expected format in error message
- [ ] Update `index.js` to use validation (AC: 6)
  - [ ] Import `validateConfig`
  - [ ] Call on startup before processing queries
  - [ ] Exit with code 1 if validation fails

## Dev Notes
**Config Module Location:** `src/config.js`

**Validation Result Type:**
```javascript
/**
 * @typedef {Object} ValidationResult
 * @property {boolean} valid - Whether all configuration is valid
 * @property {string[]} errors - List of validation error messages
 */
```

**Domain Validation Regex:**  
Basic validation - must contain at least one dot, no spaces:
```javascript
const domainRegex = /^[a-zA-Z0-9]([a-zA-Z0-9-]*\.)+[a-zA-Z]{2,}$/;
```

**Error Message Format:**
```
Configuration Error: PLAUSIBLE_DOMAIN is not set
  Expected: Your Plausible domain (e.g., developmentseed.org)
  Current:  (empty)
```

**Optional Variables:**  
Variables like `SLACK_WEBHOOK_URL` should NOT cause validation failure if missing - they enable optional features.

### Testing
- Remove PLAUSIBLE_DOMAIN from .env, run script → should exit with error
- Set PLAUSIBLE_DOMAIN to invalid value (e.g., "not a domain"), run script → should exit with error
- Set valid PLAUSIBLE_DOMAIN, run script → should pass validation

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-05 | 0.1 | Initial story created | PO Agent |
