# Story 3.2: GitHub Stats Integration

## Status
Draft

## Story
**As a** developer advocate,  
**I want** to track GitHub repository statistics for DS projects,  
**so that** I can correlate search interest with actual project engagement.

## Acceptance Criteria
1. Optional GitHub API integration for configured repositories (feature flag)
2. Track: stars, forks, open issues count for each repository
3. Send separate `GEO_GitHub_Stats` event type to Plausible
4. Use `GITHUB_TOKEN` for authenticated requests (higher rate limits)
5. Gracefully skip if GitHub API fails (don't block main tracking)

## Tasks / Subtasks
- [ ] Create `src/sources/github-stats.js` module (AC: 1)
  - [ ] Export `fetchGitHubStats(owner, repo)` async function
  - [ ] Return stats object or null on failure
- [ ] Add repository configuration (AC: 1)
  - [ ] Create `src/repositories.js` config file
  - [ ] Define list of repos to track (owner/repo format)
- [ ] Implement stats fetching (AC: 2)
  - [ ] Use GitHub REST API `/repos/{owner}/{repo}`
  - [ ] Extract: stargazers_count, forks_count, open_issues_count
  - [ ] Handle rate limiting
- [ ] Send GitHub stats events (AC: 3)
  - [ ] Create separate event type: `GEO_GitHub_Stats`
  - [ ] Include: repo_name, stars, forks, open_issues, timestamp
- [ ] Configure authentication (AC: 4)
  - [ ] Check for GITHUB_TOKEN env var
  - [ ] Add Authorization header if token exists
  - [ ] Work without token (lower rate limits)
- [ ] Add error handling (AC: 5)
  - [ ] Catch API errors per repository
  - [ ] Log failures but continue with other repos
  - [ ] Don't block main GEO query tracking

## Dev Notes
**Module Location:** `src/sources/github-stats.js`

**Repositories Config:**
```javascript
// src/repositories.js
export default [
  { owner: 'developmentseed', repo: 'titiler' },
  { owner: 'developmentseed', repo: 'cogeo-mosaic' },
  { owner: 'radiantearth', repo: 'stac-spec' },
];
```

**GitHub API:**
```javascript
const response = await fetch(`https://api.github.com/repos/${owner}/${repo}`, {
  headers: {
    'Accept': 'application/vnd.github.v3+json',
    'Authorization': `token ${process.env.GITHUB_TOKEN}`,
    'User-Agent': 'geo-tracker'
  }
});
```

**Rate Limits:**
- Unauthenticated: 60 requests/hour
- Authenticated: 5000 requests/hour

**Event Props:**
```javascript
{
  repo_name: 'developmentseed/titiler',
  stars: 542,
  forks: 123,
  open_issues: 45,
  timestamp: '2026-02-05T09:00:00Z'
}
```

**Environment Variables:**
- `ENABLE_GITHUB_STATS=true` - Enable GitHub stats tracking
- `GITHUB_TOKEN` - Optional, GitHub personal access token

### Testing
- Run without ENABLE_GITHUB_STATS → should skip GitHub tracking
- Run with invalid repo → should log error and continue
- Run with valid token → should see higher rate limits
- Check Plausible for `GEO_GitHub_Stats` events

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-05 | 0.1 | Initial story created | PO Agent |
