# Story 1.5: GitHub Actions Workflow

## Status
InProgress

## Story
**As a** developer,  
**I want** a GitHub Actions workflow that runs the tracker daily,  
**so that** tracking happens automatically without manual intervention.

## Acceptance Criteria
1. `.github/workflows/geo-tracker.yml` workflow file created
2. Workflow runs on schedule: daily at 9:00 AM UTC (`cron: '0 9 * * *'`)
3. Workflow can be triggered manually via `workflow_dispatch`
4. Workflow uses Node.js 20 LTS
5. Workflow installs dependencies and runs `node index.js`
6. `PLAUSIBLE_DOMAIN` passed as environment variable from GitHub secrets
7. Workflow logs are visible in GitHub Actions tab

## Tasks / Subtasks
- [ ] Create `.github/workflows/` directory structure (AC: 1)
- [ ] Create `geo-tracker.yml` workflow file (AC: 1)
- [ ] Configure workflow triggers (AC: 2, 3)
  - [ ] Add `schedule` trigger with cron expression `0 9 * * *`
  - [ ] Add `workflow_dispatch` for manual triggering
- [ ] Configure job environment (AC: 4)
  - [ ] Set `runs-on: ubuntu-latest`
  - [ ] Use `actions/setup-node@v4` with Node.js 20
- [ ] Configure job steps (AC: 5)
  - [ ] Checkout repository with `actions/checkout@v4`
  - [ ] Setup Node.js 20
  - [ ] Install dependencies with `npm ci`
  - [ ] Run tracker with `node index.js`
- [ ] Configure secrets (AC: 6)
  - [ ] Pass `PLAUSIBLE_DOMAIN` from `secrets.PLAUSIBLE_DOMAIN`
  - [ ] Document required GitHub secrets in README
- [ ] Test workflow execution (AC: 7)
  - [ ] Manually trigger workflow
  - [ ] Verify logs appear in Actions tab

## Dev Notes
**Workflow File Location:**  
`.github/workflows/geo-tracker.yml`

**Cron Schedule:**  
`0 9 * * *` = Daily at 9:00 AM UTC
- Use https://crontab.guru to verify: "At 09:00"
- GitHub Actions cron has ~5-15 minute variance

**Required GitHub Secrets:**
Configure these in repository Settings → Secrets and variables → Actions:
- `PLAUSIBLE_DOMAIN` - The domain registered in Plausible (e.g., `developmentseed.org`)

**Workflow Structure:**
```yaml
name: GEO Tracker
on:
  schedule:
    - cron: '0 9 * * *'
  workflow_dispatch:

jobs:
  track:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - run: npm ci
      - run: node index.js
        env:
          PLAUSIBLE_DOMAIN: ${{ secrets.PLAUSIBLE_DOMAIN }}
```

**npm ci vs npm install:**  
Use `npm ci` in CI environments - it's faster and ensures reproducible builds from `package-lock.json`.

### Testing
1. Push workflow file to repository
2. Go to Actions tab in GitHub
3. Select "GEO Tracker" workflow
4. Click "Run workflow" button
5. Verify job runs successfully
6. Check logs for expected output

**Note:** You must configure `PLAUSIBLE_DOMAIN` secret before the workflow will succeed.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-05 | 0.1 | Initial story created | PO Agent |
