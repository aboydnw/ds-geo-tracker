# Story 1.5: GitHub Actions Workflow

## Status
Ready for Review

## Story
**As a** developer,  
**I want** a GitHub Actions workflow that runs the tracker daily,  
**so that** tracking happens automatically without manual intervention.

## Acceptance Criteria
1. `.github/workflows/geo-tracker.yml` workflow file created
2. Workflow runs on schedule: daily at 9:00 AM UTC (`cron: '0 9 * * *'`)
3. Workflow can be triggered manually via `workflow_dispatch`
4. Workflow uses Node.js 20 LTS
5. Workflow installs dependencies and runs `node index.js`
6. `PLAUSIBLE_DOMAIN` passed as environment variable from GitHub secrets
7. Workflow logs are visible in GitHub Actions tab

## Tasks / Subtasks
- [x] Create `.github/workflows/` directory structure (AC: 1)
- [x] Create `geo-tracker.yml` workflow file (AC: 1)
- [x] Configure workflow triggers (AC: 2, 3)
  - [x] Add `schedule` trigger with cron expression `0 9 * * *`
  - [x] Add `workflow_dispatch` for manual triggering
- [x] Configure job environment (AC: 4)
  - [x] Set `runs-on: ubuntu-latest`
  - [x] Use `actions/setup-node@v4` with Node.js 20
- [x] Configure job steps (AC: 5)
  - [x] Checkout repository with `actions/checkout@v4`
  - [x] Setup Node.js 20
  - [x] Install dependencies with `npm ci`
  - [x] Run tracker with `node index.js`
- [x] Configure secrets (AC: 6)
  - [x] Pass `PLAUSIBLE_DOMAIN` from `secrets.PLAUSIBLE_DOMAIN`
  - [x] Document required GitHub secrets in README
- [ ] Test workflow execution (AC: 7)
  - [ ] Manually trigger workflow
  - [ ] Verify logs appear in Actions tab

## Dev Notes
**Workflow File Location:**  
`.github/workflows/geo-tracker.yml`

**Cron Schedule:**  
`0 9 * * *` = Daily at 9:00 AM UTC
- Use https://crontab.guru to verify: "At 09:00"
- GitHub Actions cron has ~5-15 minute variance

**Required GitHub Secrets:**
Configure these in repository Settings → Secrets and variables → Actions:
- `PLAUSIBLE_DOMAIN` - The domain registered in Plausible (e.g., `developmentseed.org`)

**Workflow Structure:**
```yaml
name: GEO Tracker
on:
  schedule:
    - cron: '0 9 * * *'
  workflow_dispatch:

jobs:
  track:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - run: npm ci
      - run: node index.js
        env:
          PLAUSIBLE_DOMAIN: ${{ secrets.PLAUSIBLE_DOMAIN }}
```

**npm ci vs npm install:**  
Use `npm ci` in CI environments - it's faster and ensures reproducible builds from `package-lock.json`.

### Testing
1. Push workflow file to repository
2. Go to Actions tab in GitHub
3. Select "GEO Tracker" workflow
4. Click "Run workflow" button
5. Verify job runs successfully
6. Check logs for expected output

**Note:** You must configure `PLAUSIBLE_DOMAIN` secret before the workflow will succeed.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-05 | 0.1 | Initial story created | PO Agent |
| 2026-02-06 | 0.2 | Implementation complete, pushed to GitHub | Dev Agent |

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (Cursor IDE)

### Debug Log References
None - clean implementation.

### Completion Notes
- Created `.github/workflows/geo-tracker.yml` workflow file
- Workflow runs daily at 9:00 AM UTC and supports manual dispatch
- Uses Node.js 20 with npm caching for faster installs
- Created comprehensive README.md with setup instructions
- Fixed GitHub push protection issue (example webhook URL pattern)
- Code successfully pushed to https://github.com/aboydnw/ds-geo-tracker

**Manual step required:** Configure `PLAUSIBLE_DOMAIN` secret in GitHub repository settings, then manually trigger workflow to verify.

### File List
| Action | File |
|--------|------|
| Created | `.github/workflows/geo-tracker.yml` |
| Created | `README.md` |
| Modified | `geo_tracking_plan/example_env` (fixed webhook URL pattern) |
