# Story 2.4: Enhanced Logging & Summary

## Status
Draft

## Story
**As a** developer,  
**I want** structured logging with a clear run summary,  
**so that** I can quickly understand what happened in each run.

## Acceptance Criteria
1. Each log line includes ISO timestamp prefix
2. Run summary includes: total queries, successful events, failed events, duration
3. Failed events are listed with query name and error reason
4. Log output is clean and parseable (minimal emoji in production)
5. `LOG_LEVEL` environment variable controls verbosity (info, debug)

## Tasks / Subtasks
- [ ] Create `src/logger.js` utility (AC: 1, 4, 5)
  - [ ] Implement `log(level, message)` function
  - [ ] Add timestamp prefix to all messages
  - [ ] Respect LOG_LEVEL environment variable
  - [ ] Export convenience methods: `info`, `debug`, `warn`, `error`
- [ ] Update main script to use logger (AC: 1)
  - [ ] Replace console.log calls with logger functions
  - [ ] Use appropriate log levels
- [ ] Implement run summary (AC: 2)
  - [ ] Track start time at beginning of run
  - [ ] Calculate duration at end
  - [ ] Count total, successful, failed events
  - [ ] Format and log summary
- [ ] Track and report failures (AC: 3)
  - [ ] Store failed query info during processing
  - [ ] Include query name and error reason
  - [ ] List all failures in summary
- [ ] Configure log levels (AC: 5)
  - [ ] `info` (default): startup, progress, summary
  - [ ] `debug`: detailed payloads, HTTP responses
  - [ ] Document in .env.example

## Dev Notes
**Logger Module Location:** `src/logger.js`

**Log Levels:**
- `error` - Critical errors, always shown
- `warn` - Warnings, shown at info and above
- `info` - Normal operation (default)
- `debug` - Detailed debugging info

**Log Format:**
```
2026-02-05T09:00:00.123Z [INFO] Starting GEO Tracker
2026-02-05T09:00:00.456Z [INFO] Processing query 1/10: VEDA Dashboard
2026-02-05T09:00:01.789Z [DEBUG] Payload: { ... }
2026-02-05T09:00:02.012Z [INFO] Event sent successfully
```

**Summary Format:**
```
============================================================
GEO Tracker Run Summary
============================================================
Total queries:    10
Successful:       9
Failed:           1
Duration:         5.2s

Failed Events:
  - titiler: HTTP 429 (rate limited)
============================================================
```

**Environment Variable:**
- `LOG_LEVEL=info` (default) or `debug`

### Testing
- Run with default LOG_LEVEL → should see info messages
- Run with LOG_LEVEL=debug → should see detailed payloads
- Simulate failure → should appear in summary with reason
- Verify timestamps are ISO format

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-05 | 0.1 | Initial story created | PO Agent |
