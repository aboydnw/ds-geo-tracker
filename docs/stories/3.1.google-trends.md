# Story 3.1: Google Trends Integration

## Status
Draft

## Story
**As a** product manager,  
**I want** to track Google Trends interest levels for GEO queries,  
**so that** I can see actual search volume trends over time.

## Acceptance Criteria
1. Optional `google-trends-api` integration (feature flag to enable)
2. For each query, fetch 7-day interest data from Google Trends
3. Include `interest_value` (0-100 scale) in Plausible event props
4. Gracefully skip if Google Trends API fails (still send basic event)
5. Rate limit requests to avoid Google blocking (minimum 2s between calls)

## Tasks / Subtasks
- [ ] Install `google-trends-api` package (AC: 1)
- [ ] Create `src/sources/google-trends.js` module (AC: 1)
  - [ ] Export `fetchTrendsData(searchTerm)` async function
  - [ ] Return interest value or null on failure
- [ ] Implement trends fetching (AC: 2)
  - [ ] Use `interestOverTime` API
  - [ ] Query last 7 days
  - [ ] Extract latest interest value
- [ ] Integrate with main tracking flow (AC: 3)
  - [ ] Check if ENABLE_GOOGLE_TRENDS is set
  - [ ] Fetch trends for first searchTerm of each query
  - [ ] Add `interest_value` to event props
- [ ] Add graceful failure handling (AC: 4)
  - [ ] Catch and log Google Trends errors
  - [ ] Continue with basic event if trends fail
  - [ ] Don't block other queries
- [ ] Implement rate limiting (AC: 5)
  - [ ] Add 2000ms delay between Google Trends calls
  - [ ] Consider queuing mechanism for many queries

## Dev Notes
**Module Location:** `src/sources/google-trends.js`

**Google Trends API:**
```javascript
import googleTrends from 'google-trends-api';

const results = await googleTrends.interestOverTime({
  keyword: 'satellite imagery',
  startTime: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000),
  granularTimeResolution: true,
});
```

**Interest Value:**
- Scale: 0-100
- 100 = peak popularity
- 50 = half as popular as peak
- 0 = not enough data

**Environment Variables:**
- `ENABLE_GOOGLE_TRENDS=true` - Enable Google Trends integration

**Rate Limiting:**  
Google will block requests if too frequent. Minimum 2 seconds between calls recommended.

**Considerations:**
- Google Trends API is unofficial and may break
- Results are relative, not absolute search volume
- May need proxy or different approach for production scale

### Testing
- Run with ENABLE_GOOGLE_TRENDS unset → should skip trends
- Run with ENABLE_GOOGLE_TRENDS=true → should fetch trends
- Simulate API failure → should continue with basic event
- Monitor for rate limiting (HTTP 429)

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-05 | 0.1 | Initial story created | PO Agent |
